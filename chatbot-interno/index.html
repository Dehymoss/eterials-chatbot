<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Interno - Eterials</title>
    <script>
        // Función para obtener el número de mesa desde la URL
        function obtenerNumeroMesa() {
            let params = new URLSearchParams(window.location.search);
            return params.get("mesa") || "Sin número";
        }

        // Función para mostrar el saludo con número de mesa y nombre
        function mostrarSaludo() {
            let numeroMesa = obtenerNumeroMesa();
            let nombreCliente = localStorage.getItem("nombreCliente") || "Invitado";

            document.getElementById("saludo").innerHTML = `¡Hola, ${nombreCliente}! Estás en la mesa ${numeroMesa}.`;
        }

        // Guardar el nombre del cliente en localStorage
        function guardarNombre() {
            let nombre = document.getElementById("nombre").value;
            localStorage.setItem("nombreCliente", nombre);
            mostrarSaludo();
            reiniciarInactividad(); // Reiniciar el temporizador cuando se guarda el nombre
        }

        // Sistema de inactividad con vibración
        let inactividadTimer;

        function reiniciarInactividad() {
            clearTimeout(inactividadTimer);
            inactividadTimer = setTimeout(preguntarAntesDeCerrar, 180000); // 3 minutos
        }

        function preguntarAntesDeCerrar() {
            if ("vibrate" in navigator) {
                navigator.vibrate([200, 100, 200]); // Vibración para captar atención
            }
            let respuesta = confirm("¿Deseas seguir en la sesión o finalizar?");
            if (!respuesta) cerrarSesion();
            else reiniciarInactividad(); // Si el usuario sigue, reinicia el temporizador
        }

        function cerrarSesion() {
            alert("Sesión finalizada.");
            window.location.href = "https://dehymoss.github.io/eterials-chatbot/";
        }

        // Detectar actividad del usuario y reiniciar el temporizador
        document.addEventListener("mousemove", reiniciarInactividad);
        document.addEventListener("keydown", reiniciarInactividad);

        window.onload = function() {
            mostrarSaludo();
            reiniciarInactividad(); // Iniciar detección de inactividad al cargar
        };
    </script>
</head>
<body>
    <h1>Bienvenido al Asistente de Mesa</h1>
    <h2 id="saludo">Cargando...</h2>
    <p>Ingresa tu nombre para personalizar tu experiencia:</p>
    <input type="text" id="nombre" placeholder="Escribe tu nombre">
    <button onclick="guardarNombre()">Guardar Nombre</button>
</body>
</html>